# SQLD_함수

## 내장 함수

- 함수는 다양한 기준으로 분류할 수 있는데, 벤더에서 제공하는 함수인 내장 함수와 사용자가 정의할 수 있는 함수로 나눌 수 있다.
- 본 절에서는 각 벤더에서 제공하는 데이터베이스를 설치하면 기본적으로 제공되는 SQL 내장 함수에 대해 설명한다.
- 내장 함수는 SQL을 더욱 강력하게 해주고 데이터 값을 간편하게 조작하는데 사용된다.
- 내장 함수는 벤더별로 가장 큰 차이를 보이는 부분이지만, 핵심적인 기능들은 이름이나 표현법이 다르더라도 대부분의 데이터베이스가 공통적으로 제공하고 있다.
- 내장 함수는 다시 함수의 입력 값이 단일행 값이 입력되는 단일행 함수와 여러 행의 값이 입력되는 다중행 함수로 나눌 수 있다.
- 함수는 입력되는 값이 아무리 많아도 출력은 하나만 된다는 M:1 관계라는 중요한 특징을 가지고 있다. 
- 단일행 함수의 경우, 단일행 내에 있는 하나의 값 또는 여러 값이 입력 인수로 표현될 수 있다.
  - SELECT, WHERE, ORDER BY 절에 사용 가능하다
  - 각 행들에 대해 개별적으로 작용하여 데이터 값들을  조작하고, 각각의 행에 대한 조작 결과를 리턴한다.
  - 여러 인자를 입력해도 단 하나의 결과만 리턴한다.
  - 함수의 인자로 상수, 변수, 표현식이 사용 가능하고, 하나의 인수를 가지는 경우도 있지만, 여러 개의 인수를 가질 수도 있다.
  - 특별한 경우가 아니면 함수의 인자로 함수를 사용하는 함수의 중첩이 가능하다.
- 다중행 함수의 경우도 여러 레코드의 값들을 입력 인수로 사용하는 것이다.



## 문자형 함수

|       문자형 함수        |                          함수 설명                           |
| :----------------------: | :----------------------------------------------------------: |
|          LOWER           |         문자열의 알파벳 문자를 소문자로 바꾸어 준다.         |
|          UPPER           |         문자열의 알파벳 문자를 대문자로 바꾸어 준다.         |
|          ASCII           |         문자나 숫자를 ASCII 코드 번호로 바꾸어 준다.         |
|         CHR/CHAR         |         ASCII 코드 번호를 문자나 숫자로 바꾸어 준다.         |
| CONCAT(문자열1, 문자열2) | 문자열1과 문자열2를 연결한다. 합성 연산자 \|\| 나  +와 동일하다. |
|        LENGTH/LEN        |             문자열의 개수를 숫자값으로 돌려준다.             |
|          LTRIM           | 문자열의 첫 문자부터 확인해서 지정 문자가 나타나면 해당 문자를 제거한다. |
|          RTRIM           | 문자열의 마지막 문자부터 확인해서 지정 문자가 나타나는 동안 해당 문자를 제거한다. |
|           TRIM           | 문자열에서 머리말, 꼬리말, 또는 양쪽에 있는 지정 문자를 제거한다. |

- DUAL 테이블
  - 데이터 딕셔너리와 함께 Oracle에 의해 자동으로 생성되는 테이블
  - 사용자 SYS의 스키마에 있지만 모든 사용자는 DUAL이라는 이름으로 엑세스 할 수 있습니다.
  - DUAL 테이블은 VARCHAR2(1)으로 정의된 DUMMY라는 하나의 열이 잇으며 값을 가지는 하나의 행도 포함되어 있습니다.
  - DUAL 테이블은 사용자가 계산이나, 사용자 함수 등을 실행하고자 할 경우에 유용하다
  - 특성
    - 사용자 SYS가 소유하며 모든 사용자가 액세스 가능한 테이블
    - SELECT ~ FROM ~ 의 형식을 갖추기 위한 일종의 DUMMY 테이블
    - DUMMY라는 문자열 유형의 칼럼에 'X'라는 값이 들어 있는 행을 1건 포함하고 있다.
- 특별한 제약 조건이 없다면 함수는 여러 개 중첩하여 사용이 가능하다.



## 숫자형 함수

|             숫자형 함수             |                      함수 설명                      |
| :---------------------------------: | :-------------------------------------------------: |
|                 ABS                 |              숫자의 절대값을 돌려준다.              |
|                SIGN                 |     숫자가 양수인지, 음수인지 0인지를 구별한다.     |
|                 MOD                 |    숫자1을 숫자2로 나누어 나머지 값을 리턴한다.     |
|                CEIL                 |        숫자보다 크거나 같은 최소 정수를 리턴        |
|                FLOOR                |        숫자보다 작거나 같은 최대 정수를 리턴        |
|                ROUND                |       숫자를 소수점 M자리에서 반올림하여 리턴       |
|                TRUNC                |        숫자를 소수 M자리에서 잘라서 버린다.         |
|          SIN, COS, TAN...           |            숫자의 삼각함수 값을 리턴한다            |
| EXP(), POWER(), SQRT(), LOG(), LN() | 숫자의 지수, 거듭 제곱, 제곱근, 자연 로그 값을 리턴 |



## 날짜형 함수

|                         날짜형 함수                          |                          함수 설명                           |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                     SYSDATE / GETDATE()                      |                 현재 날짜와 시각을 출력한다.                 |
| EXTRACT('YEAR'\|'MONTH\|'DAY' from d) / DATEPART('YEAR'\|'MONTH\|'DAY', d) | 날짜 데이터에서 년/월/일 데이터를 출력할 수 있다. 시간/분/초도 가능함 |
|           TO_NUMBER(TO_CHAR(d, 'YYYY')) / YEAR(d)            | 날짜 데이터에서 년/월/일 데이터를 출력할 수 있다. TO_NUMBER 함수 제외시 문자형으로 출력됨 |

- 데이터베이스는 날짜를 숫자로 저장하기 때문에 덧셈, 뺄셈 같은 산술 연산자로도 계산이 가능하다.



## 변환형 함수

- 변환형 함수는 특정 데이터 타입을 다양한 형식으로 출력하고 싶을 경우엔 사용되는 함수
- 종류
  - 명시적 데이터 유형 변환
  - 암시적 데이터 유형 변환
    - 암시적 데이터 유형 변환의 경우 성능 저하가 발생할 수 있으며, 자동적으로 데이터 베이스가 알아서 계산하지 않는 경우가 있어 에러를 발생할 수 있으므로 명시적 데이터 유형 변환 방법을 사용하는 것이 바람직하다.



## CASE 표현

- IF-THEN-ELSE 논리와 유사한 방식으로 표현식을 작성해서 SQL의 비교 연산 기능을 보완하는 역할을 한다.

  ```sql
  SELECT ENAME,
  	CASE
  	WHEN SAL > 2000
  	THEN SAL
  	ELSE 2000
  	END REVISED_SALARY
  FROM EMP;
  ```

- SIMPLE_CASE_EXPRESSION

- SEARCHED_CASE_EXPRESSION



### NVL/ISNULL 함수

- 결과값을 NULL이 아닌 다른 값을 얻고자 할 때 NVL/ISNULL 함수를 사용한다.
- NULL 값의 대상이 숫자 유형 데이터인 경우는 주로 0으로, 문자 유형 데이터인 경우는 블랭크보다는 'X' 같이 해당 시스템에서 의미없는 문자로 바꾸는 경우가 많다.



### NULL과 공집합

- 일반적인 NVL/ISNULL 함수 사용
  - 매니저에 NULL이 들어있는 KING의 매니저를 출력한다.
- 공집합의 NVL/ISNULL 함수 사용
  - SELECT 1 FROM DUAL WHERE 1 = 2;와 같은 조건이 대표적인 공집합을 발생시키는 쿼리
  - 위와 같이 조건에 맞는 데이터가 한 건도 없는 경우를 공집합이라고 한다.
  - NULL 데이터와는 또 다르게 이해해야 한다.
  - 공집합을 다른 값으로 바꾸지는 못한다.



### NULLIF

- EXPR1 = EXPR2, NULL
- EXPR1 != EXPR2, EXPR1



### 기타 NULL 관련 함수(COALESCE)

- 인수의 숫자가 한정되어 있지 않으며, 임의의 개수 EXPR에서 NULL이 아닌 최초의 EXPR을 나타낸다.
- 만일 모든 EXPR이 NULL이라면 NULL을 리턴한다.

