# SQLD_서브쿼리

- 하나의 SQL문 안에 포함되어 있는 또 다른 SQL문을 말한다.
- 주의사항
  - 괄호로 감싸서 사용한다.
  - 단일 행 또는 복수 행 비교 연산자와 함께 사용 가능하다.
    - 단일 행 비교 연산자는 서브쿼리의 결과가 반드시 1건 이하이어야 하고 복수 행 비교 연산자는 서브쿼리의 결과 건수와 상관없다.
  - 서브쿼리에서는 ORDER BY를 사용하지 못한다. 메인쿼리의 마지막 문장에 위치해야 한다.
- SQL문에서 사용이 가능한 곳은 다음과 같다.
  - SELECT 절, FROM 절, WHERE 절, HAVING 절, ORDER BY 절, INSERT문의 VALUES 절, UPDATE SET절
- 동작방식에 따른 서브쿼리의 종류
  - 비연관 서브쿼리
    - 메인쿼리 칼럼을 가지고 있지 않은 형태
    - 메인쿼리에 값을 제공하기 위한 목적으로 주로 사용한다.
  - 연관 서브쿼리
    - 메인쿼리 칼럼을 가지고 있는 형태
    - 메인쿼리가 먼저 수행되어 읽혀진 데이터를 서브쿼리에서 조건이 맞는지 확인하고자 할 때 주로 사용된다.
- 반환되는 데이터의 형태에 따라 서브쿼리 분류
  - 단일 행 서브쿼리
    - 서브쿼리가 단일 행 비교 연산자와 함께 사용할 때는 서브쿼리의 결과 건수가 반드시 1건 이하이어야 한다.
  - 다중 행 서브쿼리
  - 다중 칼럼 서브쿼리
    - 서브쿼리의 결과로 여러 개의 칼럼이 반환되어 메인쿼리의 조건과 동시에 비교되는 것을 의미한다.



## 연관 서브쿼리

- 서브쿼리 내에 메인쿼리 칼럼이 사용된 서브쿼리이다.



## 그밖에 위치에서 사용하는 서브쿼리

- SELECT 절에 서브쿼리 사용하기
  - 스칼라 서브쿼리는 한 행, 한 칼럼만을 반환하는 서브쿼리를 말한다.
  - 단일 행 서브쿼리이기 때문에, 결과가 2건 이상 반환되면 SQL문은 오류를 반환한다.
- FROM 절에서 서브쿼리 사용하기
  - 인라인 뷰라고 한다.
    - SQL문이 실행될 때만 임시적으로 생성되는 동적인 뷰
    - 데이터베이스에 해당 정보가 저장되지 않는다.
    - 그래서 일반적인 뷰를 정적 뷰라고 한다.
- HAVING 절에서 서브쿼리 사용하기
  - 그룹함수와 함께 사용될 때 그룹핑된 결과에 대해 부가적인 조건을 주기 위해서 사용한다.
- UPDATE문의 SET 절에서 사용하기
  - 서브쿼리를 사용한 변경 작업을 할 때 서브쿼리의 결과가 NULL을 반환할 경우 해당 컬럼의 결과가 NULL이 될 수 있기 때문에 주의해야 한다.
- INSERT문의 VALUES절에서 사용하기



## 뷰

- 테이블은 실제로 데이터를 가지고 있는 반면, 뷰는 실제 데이터를 가지고 잇지 않다.
- 뷰는 단지 뷰 정의만을 가지고 있다.
- 질의에서 뷰가 사용되면 뷰 정의를 참조해서 DBMS 내부적으로 질의를 재작성하여 질의를 수행한다.
- 뷰는 실제 데이터를 가지고 있지 않지만 테이블이 수행하는 역할을 수행하기 때문에 가상 테이블이라고도 한다.
- 뷰 사용의 장점
  - 독립성
    - 테이블 구조가 변경되어도 뷰를 사용하는 응용 프로그램은 변경하지 않아도 된다.
  - 편리성
    - 복잡한 질의를 뷰로 생성함으로써 관련 질의를 단순하게 작성할 수 있다. 또한, 해당 형태의 SQL문을 자주 사용할 때 뷰를 이용하면 편리하게 사용할 수 있다.
  - 보안성
    - 직원의 급여정보와 같이 숨기고 싶은 정보가 존재한다면, 뷰를 생성할 때 해당 칼럼을 빼고 생성함으로써 사용자에게 정보를 감출 수 있다.



