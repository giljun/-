# SQLD_조인 수행 원리

## 조인 수행 원리

### 조인

- 두 개 이상의 테이블을 하나의 집합으로 만드는 연산
- 종류
  - NL JOIN, SORT MERGE JOIN, HASH JOIN



## NL JOIN

- 두 개의 테이블을 중첩된 반복문처럼 조인을 수행한다.
- 반복문 외부에 있는 테이블을 선행 테이블 또는 외부 테이블
- 반복문 내부에 있는 테이블을 후행 테이블 또는 내부 테이블 이라고 한다.
- 중요사항
  - 결과 행의 수가 적은 테이블을 선행 테이블로 선택한다.
- 수행 방식
  - 선행 테이블에서 조건에 맞는 값을 찾음
  - 선행 테이블의 조인 키를 가지고 후행 테이블 조인 키를 확인
  - 후행 테이블의 인덱스에 선행 테이블의 조인 키 존재 확인
  - 인덱스에서 추출한 레코드 식별자를 이용하여 후행 테이블 액세스
  - 앞의 작업을 반복 수행함.



## SORT MERGE JOIN

### 정의

- 조인 칼럼을 기준으로 데이터를 정렬하여 조인한다.



### 특징

- 넓은 범위의 데이터를 처리할 때 주로 이용
- 정렬 데이터가 많을 경우 성능이 떨어질 수 있다.
- 비동등 조인에 대해서도 조인이 가능
- 인덱스를 사용하지 않아 인덱스가 존재하지 않을 경우에 사용할 수 있다.



### 수행 방식

- 선행 테이블에서 조건에 맞는 행을 찾음
- 선행 테이블의 조인 키를 기준으로 정렬 작업 수행
- ~ 앞의 작업을 반복 수행
- 후행 테이블에서 조건에 맞는 행을 찾음
- 후행 테이블의 조인 키를 기준으로 정렬 작업 수행
- ~ 앞의 작업을 반복 수행
- 정렬된 결과를 이용하여 조인 수행
  - 결과값은 버퍼에 저장



## HASH JOIN

- 해싱 기법을 이용하여 조인 수행



### 특징

- NL JOIN의 랜덤 액세스 문제점과 SORT MERGE JOIN의 정렬 작업의 부담을 해결 위한 대안으로 사용
- 조인 칼럼의 인덱스가 존재하지 않을 경우에도 사용할 수 있다.
- "="로 수행하는 조인 즉, 동등 조인만 가능
- 해쉬 테이블의 크기가 메모리에 적재할 수 있는 크기보다 커지면 디스트 사용
- 해쉬 조인을 할 때 결과 행의 수가 적은 테이블을 선행 테이블로 사용한다.



### 수행 방식

- 선행 테이블에서 조건에 만족하는 행을 찾음
- 선행 테이블의 조인 키를 기준으로 해쉬 함수를 적용하여 해쉬 테이블 생성
- ~ 앞의 작업을 선행 테이블의 조건만큼 반복
- 후행 테이블에서 조건에 만족하는 행을 찾음
- 후행 테이블의 조인 키를 기준으로 해쉬 함수를 적용하여 해당 버킷을 찾음
- 조인에 성공하면 추출버퍼에 저장
- ~ 앞의 작업을 후행 테이블의 조건만큼 수행



