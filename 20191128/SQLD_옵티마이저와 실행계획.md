# SQLD_옵티마이저와 실행계획

## 옵티마이저

- 사용자가 질의한 SQL문에 대해 최적의 실행 방법을 결정하는 역할 수행
- 이러한 최적의 실행 방법을 실행계획이라 함
  - 어떤 방법으로 처리하는 것이 최소 일량으로 동일한 일을 처리할 수 있을지 결정하는 것



## 규칙기반 옵티마이저

- 규칙을 가지고 실행계획을 생성
- 실행계획을 생성하는 규칙을 이해하면 누구나 실행계획을 비교적 쉽게 예측 가능
- 인덱스를 이용한 액세스 방식이 전체 테이블 액세스 방식보다 우선 순위가 높음
  - 이용 가능한 인덱스가 존재한다면 전체 테이블 액세스 방식보다는 항상 인덱스를 사용하는 실행계획 생성
- 조인 순서를 결정 시 조인 칼럼 인덱스의 존재 유무가 중요한 판단의 기준
  - 양쪽에 존재
    - 우선 순위가 높은 테이블이 선행 테이블
  - 한쪽에만 존재
    - 인덱스가 없는 테이블이 선행 테이블
  - 모두 인덱스가 존재 하지 않는 경우
    - FROM 절의 뒤에 나열된 테이블이 선행 테이블로 선택
  - 우선 순위가 동일
    - FROM 절에 나열된 테이블의 역순으로 선행 테이블 선택

## 비용기반 옵티마이저

- 비용이 가장 적은 실행계획을 선택하는 방식
- 규칙기반 옵티마이저의 단점을 극복하기 위해서 출현
- 다양한 객체 통계정보와 시스템 통계정보 등 이용 - 통계정보 없을 경우
  - 정확한 비용 예측이 불가능해 비효율적인 실행계획 생성
- 구조
  - 질의 변환기
    - 사용자가 작성한 SQL문을 처리하기에 보다 용이한 행태로 변환하는 모듈
  - 대안 계획 생성기
    - 동일한 결과를 생성하는 다양한 대안 계획을 생성하는 모듈
    - 대안 계획은 연산의 적용 순서 변경, 연산 방법 변경, 조인 순서 변경 등을 통해 생성
    - 대안 계획의 생성이 많아지면 최적화를 수행하는 시간이 그만큼 오래 걸린다.
    - 대부분의 사용 옵티마이저들은 대안 계획의 수를 제약하는 다양한 방법 사용
  -  비용 예측기
    - 생성된 대안 계획의 비용을 예측하는 모듈
    - 연산의 중간 집합의 크기 및 결과 집합이 크기, 분포도 등의 예측이 정확해야 한다.
- 인덱스를 사용하는 비용이 전체 테이블 스캔 비용보다 크다고 판단되면 전체 테이블 스캔을 수행하는 방법으로 실행계획을 생성할 수도 있다.
- 또한, 비용기반 옵티마이저의 다양한 한계들로 인해 실행계획의 예측 및 제어가 어렵다.



## 실행계획

- SQL에서 요구한 사항을 처리하기 위한 절차와 방법
- 다양한 처리 방법마다 실행 시간은 서로 다를 수 있다.
- 실행계획 구성 요소
  - 조인 순서
  - 조인 기법
  - 액세스 기법
  - 최적화 정보
  - 연산



## SQL 처리 흐름도

- 내부적인 처리 절차를 시각적으로 표현한 도표
- 조인 순서, 액세스 기법과 조인 기법 등을 표현 가능





